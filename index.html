<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1" />
  <title>Ca√ßa‚ÄëCora√ß√µes ‚ù§Ô∏è</title>
  <style>
    :root { --bg: #0f0f13; --fg: #fff; --accent: #ff4d6d; --accent2: #ff8fab; }
    * { box-sizing: border-box; }
    html, body { height:100%; margin:0; background: radial-gradient(1200px 600px at 50% -20%, #1a1a24, var(--bg)); color: var(--fg); font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Color Emoji", "Apple Color Emoji", sans-serif;}
    .container { position: relative; height: 100%; overflow: hidden; }
    .header { position:absolute; top:12px; left:12px; right:12px; display:flex; justify-content:space-between; gap:8px; z-index:10; }
    .badge { background: rgba(255,255,255,0.08); padding:8px 12px; border-radius: 999px; font-weight:600; backdrop-filter: blur(4px); box-shadow: 0 4px 16px rgba(0,0,0,.2);}    
    .center { position:absolute; inset:0; display:flex; align-items:center; justify-content:center; }
    .card { background: linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.02)); border:1px solid rgba(255,255,255,0.08); padding:24px; border-radius:24px; box-shadow: 0 10px 40px rgba(0,0,0,.35); text-align:center; max-width: min(520px, 92vw); }
    h1 { margin:6px 0 12px; font-size: clamp(24px, 5vw, 36px); }
    p { margin: 8px 0 0; opacity:.9 }
    button { appearance:none; border:0; border-radius: 999px; padding:14px 22px; font-weight:700; font-size:16px; cursor:pointer; background: linear-gradient(135deg, var(--accent), var(--accent2)); color:#fff; box-shadow: 0 10px 24px rgba(255,77,109,.3); transition: transform .05s ease; }
    button:active { transform: translateY(2px) scale(.99); }

    #playfield { position:absolute; inset:0; overflow:hidden; touch-action: manipulation; }
    .heart { position:absolute; width:48px; height:48px; transform: rotate(-45deg); background: var(--accent); box-shadow: 0 6px 18px rgba(255,77,109,.4); cursor:pointer; z-index:5; }
    .heart::before, .heart::after { content:""; position:absolute; width:48px; height:48px; background: var(--accent); border-radius:50%; }
    .heart::before{ top:-24px; left:0; }
    .heart::after{ left:24px; top:0; }
    .pop { animation: pop .28s ease forwards; }
    @keyframes pop { 50% { transform: rotate(-45deg) scale(1.2);} 100% { transform: rotate(-45deg) scale(0);} }

    .badge #score, .badge #timer { font-variant-numeric: tabular-nums; }
    #start, #end { z-index:20; }
    #end h2 { font-size: clamp(26px, 6vw, 40px); margin: 0 0 8px; }
    #end .msg { font-size: clamp(18px, 4vw, 24px); opacity:.95 }
    .small { font-size: 13px; opacity:.8 }
    .hidden{ display:none !important }

    .confetti { position:absolute; width:16px; height:16px; pointer-events:none; transform: rotate(-45deg); background: var(--accent2); }
    .confetti::before, .confetti::after{ content:""; position:absolute; width:16px; height:16px; background: var(--accent2); border-radius:50%; }
    .confetti::before{ top:-8px; left:0; }
    .confetti::after{ left:8px; top:0; }

    .fade-in{ animation: fade .6s ease both }
    @keyframes fade{ from{ opacity:0; transform: translateY(8px)} to{ opacity:1; transform:none } }
  </style>
</head>
<body>
<div class="container">
  <div class="header">
    <div class="badge">‚ù§Ô∏è Pontos: <span id="score">0</span></div>
    <div class="badge">‚è±Ô∏è Tempo: <span id="timer">22</span>s</div>
  </div>

  <div id="playfield" aria-label="campo de jogo"></div>

  <div id="start" class="center">
    <div class="card fade-in">
      <h1>Ca√ßa‚ÄëCora√ß√µes</h1>
      <p>Toque nos cora√ß√µezinhos que subirem na tela. Junte <b id="goalText">14</b> antes do tempo acabar!</p>
      <p class="small">Funciona no celular e no PC üëç</p>
      <br>
      <button id="btnStart">Come√ßar</button>
    </div>
  </div>

  <div id="end" class="center hidden">
    <div class="card fade-in">
      <h2 id="endTitle">Miss√£o cumprida! üíò</h2>
      <p class="msg" id="loveMsg">Eu tenho uma coisa pra te dizer‚Ä¶</p>
      <p class="msg" id="loveMsg2" style="margin-top: 6px; font-weight: 700;">Joelma, eu te amo ‚ù§Ô∏è</p>
      <br>
      <button id="btnReplay">Jogar de novo</button>
    </div>
  </div>
</div>

<script>
(() => {
  // ======== CONFIGUR√ÅVEL ========
  const DURACAO_SEG = 22;              // tempo de jogo
  const META_PONTOS = 14;              // pontos para "vencer"
  const NOME_ALVO   = "Joelma";        // nome usado na mensagem
  const MENSAGEM    = "Joelma, eu te amo ‚ù§Ô∏è";
  const INTERVALO_SPAWN_MS = 520;      // intervalo entre cora√ß√µes
  // ======== FIM CONFIG ========

  const q = s => document.querySelector(s);
  const playfield = q('#playfield');
  const scoreEl = q('#score');
  const timerEl = q('#timer');
  const start = q('#start');
  const end = q('#end');
  const goalText = q('#goalText');
  const endTitle = q('#endTitle');
  const loveMsg = q('#loveMsg');
  const loveMsg2 = q('#loveMsg2');
  const btnStart = q('#btnStart');
  const btnReplay = q('#btnReplay');

  goalText.textContent = META_PONTOS;
  loveMsg.textContent = NOME_ALVO ? `Eu tenho uma coisa pra te dizer‚Ä¶` : "Eu tenho uma coisa pra te dizer‚Ä¶";
  loveMsg2.textContent = MENSAGEM;

  let running = false, score = 0, secs = DURACAO_SEG, spawnInt, timerInt;

  function rand(min, max){ return Math.random()*(max-min)+min; }
  function randint(min, max){ return Math.floor(rand(min, max)); }

  function spawnHeart(){
    if(!running) return;
    const h = document.createElement('div');
    h.className = 'heart';
    // tamanho aleat√≥rio (maior para visibilidade)
    const size = rand(40, 64);
    h.style.width = size + 'px';
    h.style.height = size + 'px';
    h.style.setProperty('--size', size + 'px');

    // posi√ß√£o inicial embaixo da tela
    const leftPct = rand(8, 92);
    h.style.left = leftPct + '%';
    h.style.top = '100vh'; // garante que come√ßa vis√≠vel (fora da √°rea) e sobe

    // intera√ß√µes
    function punctuate(){
      score++;
      scoreEl.textContent = score;
      h.classList.add('pop');
      if (navigator.vibrate) navigator.vibrate(10);
      setTimeout(()=> h.remove(), 220);
    }
    h.addEventListener('pointerdown', punctuate, {passive:true});
    h.addEventListener('click', punctuate, {passive:true});

    playfield.appendChild(h);

    // anima√ß√£o subida (Web Animations API -> mais compat√≠vel/√≥bvio)
    const driftVW = rand(-10, 10); // pequena deriva horizontal
    const duration = rand(4500, 7000);

    const anim = h.animate([
      { transform: 'translate(0, 10vh) rotate(-45deg)', opacity: 0 },
      { transform: 'translate(0, 0) rotate(-45deg)', opacity: 1, offset: 0.08 },
      { transform: `translate(${driftVW}vw, -120vh) rotate(-45deg)`, opacity: 0 }
    ], { duration, easing: 'linear' });

    anim.onfinish = () => h.remove();
  }

  function startGame(){
    score = 0; secs = DURACAO_SEG;
    scoreEl.textContent = '0';
    timerEl.textContent = String(secs);
    start.classList.add('hidden');
    end.classList.add('hidden');
    playfield.innerHTML = '';
    running = true;

    // Spawns imediatos para j√° ver cora√ß√µes
    for(let i=0;i<3;i++) setTimeout(spawnHeart, i*120);
    spawnInt = setInterval(spawnHeart, INTERVALO_SPAWN_MS);

    timerInt = setInterval(()=>{
      secs--;
      timerEl.textContent = String(secs);
      if(secs <= 0) finishGame();
    }, 1000);
  }

  function finishGame(){
    running = false;
    clearInterval(spawnInt);
    clearInterval(timerInt);
    endTitle.textContent = (score >= META_PONTOS) ? 'Miss√£o cumprida! üíò' : 'Ainda assim, preciso te dizer‚Ä¶';
    end.classList.remove('hidden');
    burstHearts((score >= META_PONTOS) ? 40 : 18);
  }

  function burstHearts(qtd){
    for(let i=0;i<qtd;i++){
      const c = document.createElement('div');
      c.className = 'confetti';
      c.style.left = rand(10, 90) + '%';
      c.style.top  = rand(35, 55) + '%';
      playfield.appendChild(c);
      const dx = rand(-60,60), dy = rand(-20, -120);
      const t = rand(600, 1400);
      const a = c.animate([
        { transform: 'translate(0,0) rotate(-45deg)', opacity: 1 },
        { transform: `translate(${dx}px, ${dy}px) rotate(-45deg)`, opacity: 0 }
      ], { duration: t, easing: 'cubic-bezier(.17,.67,.32,1.17)' });
      a.onfinish = ()=> c.remove();
    }
  }

  btnStart.addEventListener('click', startGame);
  btnReplay.addEventListener('click', startGame);

  // Personaliza√ß√£o via URL (?msg=...&meta=...)
  const params = new URLSearchParams(location.search);
  if(params.get('msg')){
    const m = decodeURIComponent(params.get('msg'));
    loveMsg2.textContent = m;
  }
  if(params.get('meta')){
    const m = Math.max(1, Number(params.get('meta'))||META_PONTOS);
    goalText.textContent = m;
  }

  // Teclado no desktop
  document.addEventListener('keydown', (e)=>{
    if(!running && (e.key===' ' || e.key==='Enter')) startGame();
  });
})();
</script>
</body>
</html>
