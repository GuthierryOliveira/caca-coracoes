<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<title>Angry Love ‚Äî Joelma v4 üíò</title>
<style>
  html,body{height:100%;margin:0;background:#0e0f14;color:#fff;font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif;overflow:hidden}
  #c{position:absolute;inset:0;width:100%;height:100%;display:block;background:linear-gradient(180deg,#12131b 0%,#0e0f14 70%)}
  .hud{position:absolute;left:12px;right:12px;top:10px;display:flex;justify-content:space-between;z-index:6;pointer-events:none}
  .badge{background:rgba(255,255,255,.08);padding:8px 12px;border-radius:999px;font-weight:700;backdrop-filter:blur(4px);box-shadow:0 4px 16px rgba(0,0,0,.25)}
  .center{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;z-index:8}
  .card{max-width:min(560px,92vw);text-align:center;border-radius:24px;padding:22px;background:linear-gradient(180deg,rgba(255,255,255,.06),rgba(255,255,255,.02));border:1px solid rgba(255,255,255,.08);box-shadow:0 10px 40px rgba(0,0,0,.35)}
  .btn{appearance:none;border:0;border-radius:999px;padding:14px 22px;font-weight:800;cursor:pointer;margin-top:14px;background:linear-gradient(135deg,#ff4d6d,#ff8fab);color:#fff;box-shadow:0 10px 24px rgba(255,77,109,.35)}
  .hide{display:none!important}
  .msg{font-size:clamp(16px,4vw,22px);opacity:.95;margin:0}
  .big{font-size:clamp(26px,6vw,42px);margin:0 0 6px}
  .hint{position:absolute;left:50%;top:56px;transform:translateX(-50%);opacity:.85;font-size:14px;z-index:5}
  .tutor{position:absolute;left:0;right:0;bottom:0;top:0;z-index:7;pointer-events:none}
</style>
</head>
<body>
<canvas id="c" aria-label="Angry Love ‚Äî Joelma v4"></canvas>
<div class="hud">
  <div class="badge">üíó Derrubados: <span id="down">0</span>/<span id="total">0</span></div>
  <div class="badge">ü´∂ Chances: <span id="shots">3</span>/3</div>
</div>
<div id="start" class="center">
  <div class="card">
    <h1 class="big">Angry Love</h1>
    <p class="msg">Puxe o estilingue e derrube o obst√°culo. Voc√™ tem <b>3 chances</b>. Ao derrubar tudo, aparece a mensagem de amor!</p>
    <button id="btnStart" class="btn">Come√ßar</button>
  </div>
</div>
<div id="win" class="center hide">
  <div class="card">
    <h1 class="big" id="finalTitle">Joelma, eu te amo ‚ù§Ô∏è</h1>
    <p class="msg">Perfeito! Quer jogar de novo?</p>
    <button id="btnAgainWin" class="btn">Jogar de novo</button>
  </div>
</div>
<div id="gameover" class="center hide">
  <div class="card">
    <h1 class="big">Acabaram as chances üòÖ</h1>
    <p class="msg">Tenta mais uma vez?</p>
    <button id="btnAgainOver" class="btn">Jogar de novo</button>
  </div>
</div>
<div class="hint" id="hint">Dica: no PC use o mouse; no celular, toque e arraste</div>
<svg class="tutor" id="tutor" viewBox="0 0 100 100" preserveAspectRatio="none">
  <circle id="mark" cx="15" cy="82" r="6" fill="none" stroke="rgba(255,255,255,.6)" stroke-width="1.5">
    <animate attributeName="r" values="4;7;4" dur="1.6s" repeatCount="indefinite" />
  </circle>
  <text x="20" y="78" font-size="4" fill="rgba(255,255,255,.75)" font-weight="700">puxe aqui</text>
  <polyline points="20,80 27,74 34,76" fill="none" stroke="rgba(255,255,255,.6)" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
</svg>

<script>
(() => {
  // CONFIG
  const NAME = "Joelma";
  const MESSAGE = `${NAME}, eu te amo ‚ù§Ô∏è`;
  const LETTERS = Array.from("J O E L M A   E U   T E   A M O");
  const BLOCKS_COUNT = 10;
  const MAX_SHOTS = 5;
  const POWER = 50; // for√ßa do estilingue (ajuste aqui)
  const FRICTION = 0.86; // atrito no ch√£o

  const canvas = document.getElementById('c');
  const ctx = canvas.getContext('2d');
  const downEl = document.getElementById('down');
  const totalEl = document.getElementById('total');
  const shotsEl = document.getElementById('shots');
  const overlayStart = document.getElementById('start');
  const overlayWin = document.getElementById('win');
  const overlayOver = document.getElementById('gameover');
  const finalTitle = document.getElementById('finalTitle');
  const btnStart = document.getElementById('btnStart');
  const btnAgainWin = document.getElementById('btnAgainWin');
  const btnAgainOver = document.getElementById('btnAgainOver');
  const hint = document.getElementById('hint');
  const tutor = document.getElementById('tutor');

  let DPR = Math.max(1, Math.min(2, window.devicePixelRatio||1));
  function resize(){ canvas.width = Math.floor(innerWidth*DPR); canvas.height = Math.floor(innerHeight*DPR); }
  resize(); addEventListener('resize', resize);

  const clamp=(v,a,b)=>Math.max(a,Math.min(b,v));
  const rand=(a,b)=>Math.random()*(b-a)+a;
  const S=v=> v*(canvas.height/700);

  const sling = { x:S(140), y:canvas.height - S(120), pulling:false, px:0, py:0 };
  const proj = { x:sling.x, y:sling.y, r:S(16), vx:0, vy:0, launched:false, sleeping:false, sleepMs:0 };
  let shotsLeft = MAX_SHOTS;
  shotsEl.textContent = shotsLeft;

  // Physics constants (units in px/s and seconds)
  let gravity = S(1400); // menor que v3 para arcos mais bonitos
  let restitution = 0.32;
  let groundY = canvas.height - S(80);

  // Blocks
  const blocks=[]; let destroyedCount=0;
  function resetBlocks(){
    blocks.length=0; lettersShown=0; destroyedCount=0; downEl.textContent=0;
    const baseX = canvas.width - S(260), baseY = groundY, bw=S(56), bh=S(28);
    let levels = Math.ceil(BLOCKS_COUNT/2), idx=0;
    for(let row=0; row<levels; row++){
      const y = baseY - row*bh; const cols = (row===0)?3:2;
      for(let c=0;c<cols && idx<BLOCKS_COUNT;c++){
        const x = baseX + (c - (cols-1)/2) * (bw + S(4));
        blocks.push({x, y:y-bh/2, w:bw, h:bh, vx:0, vy:0, static:true, hp:15, destroyed:false, fallAngle:0});
        idx++;
      }
    }
    totalEl.textContent = blocks.length;
  }

  // Letter particles that rise from under destroyed blocks
  const letterParts = []; // {char, x,y, t, dur, y0, rot, alpha}
  let lettersShown = 0;
  function spawnLetterAt(x, y){
    if(lettersShown >= LETTERS.length) return;
    let ch = LETTERS[lettersShown++];
    if(ch === " "){ ch = "‚ô•"; }
    letterParts.push({ char: ch, x, y, y0: y + S(8), t:0, dur:900 + Math.random()*300, rot:(Math.random()-.5)*0.5, alpha:0 });
  }
  function drawLetterPart(lp){
    ctx.save();
    ctx.globalAlpha = lp.alpha;
    ctx.translate(lp.x, lp.y);
    ctx.rotate(lp.rot * (lp.t/lp.dur));
    ctx.font = `bold ${S(34)}px Inter, system-ui, sans-serif`;
    ctx.fillStyle = '#ff8fab';
    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';
    ctx.fillText(lp.char, 0, 0);
    ctx.restore();
  }
  function updateLetters(dt){
    for(let i=letterParts.length-1; i>=0; i--){
      const lp = letterParts[i];
      lp.t += dt;
      const k = Math.min(1, lp.t / lp.dur);
      const ease = 1 - Math.pow(1-k, 2);
      lp.y = lp.y0 - ease * S(46);
      lp.alpha = Math.min(1, k*1.5);
      if(lp.t >= lp.dur) letterParts.splice(i,1);
    }
  }

  function circleRectColl(cx,cy,cr,rx,ry,rw,rh){
    const nx=clamp(cx,rx,rx+rw), ny=clamp(cy,ry,ry+rh); const dx=cx-nx, dy=cy-ny; return dx*dx+dy*dy<=cr*cr;
  }

  function blockHit(b, power, dirx, diry){
    if(b.destroyed) return; b.static=false; b.hp -= power; b.vx += dirx*power*0.06; b.vy += diry*power*0.06 - S(60)/1000;
    if(b.hp<=0){
      b.destroyed=true; destroyedCount++; downEl.textContent=destroyedCount;
      spawnLetterAt(b.x, b.y + b.h/2 + S(6)); // letter reveals from under
      if(navigator.vibrate) navigator.vibrate(12);
      if(destroyedCount >= blocks.length){
        setTimeout(()=>{ finalTitle.textContent = MESSAGE; overlayWin.classList.remove('hide'); }, 650);
      }
    }
  }

  function resetGame(){
    overlayWin.classList.add('hide'); overlayOver.classList.add('hide'); overlayStart.classList.remove('hide');
    tutor.style.display='block'; hint.style.opacity=1;
    proj.x=sling.x; proj.y=sling.y; proj.vx=0; proj.vy=0; proj.launched=false; proj.sleeping=false; proj.sleepMs=0; sling.pulling=false; letterParts.length=0; lettersShown=0;
    shotsLeft = MAX_SHOTS; shotsEl.textContent = shotsLeft;
    resetBlocks();
  }

  // Input helpers
  function toCanvasXY(e){ const r=canvas.getBoundingClientRect(); const x=((e.touches?e.touches[0].clientX:e.clientX)-r.left)*DPR; const y=((e.touches?e.touches[0].clientY:e.clientY)-r.top)*DPR; return {x,y}; }

  function onDown(e){
    const p=toCanvasXY(e); const dx=p.x-sling.x, dy=p.y-sling.y; const dist=Math.hypot(dx,dy);
    if(overlayStart && !overlayStart.classList.contains('hide')){ overlayStart.classList.add('hide'); tutor.style.display='none'; }
    if((!proj.launched || proj.sleeping) && shotsLeft>0){
      if(dist<S(120)){
        sling.pulling=true; sling.px=p.x; sling.py=p.y; proj.x=sling.px; proj.y=sling.py; proj.launched=false; proj.sleeping=false; proj.sleepMs=0;
      }
    }
  }
  function onMove(e){ if(!sling.pulling) return; const p=toCanvasXY(e); const dx=p.x-sling.x, dy=p.y-sling.y; const maxPull=S(140); const d=Math.min(maxPull,Math.hypot(dx,dy)); const ang=Math.atan2(dy,dx); sling.px=sling.x+Math.cos(ang)*d; sling.py=sling.y+Math.sin(ang)*d; proj.x=sling.px; proj.y=sling.py; }
  function onUp(){ if(!sling.pulling) return; sling.pulling=false; if(shotsLeft<=0) return;
    // velocity per second; invert vertical so puxar pra cima joga pra cima
    const dx = (sling.x - sling.px) * POWER;
    const dy = (sling.y - sling.py) * POWER;
    setVelocity(dx, -dy); // y invertido
    shotsLeft--; shotsEl.textContent = shotsLeft;
  }

  function setVelocity(vx,vy){ // vx,vy em px/s
    proj.vx=vx; proj.vy=vy; proj.launched=true; proj.sleeping=false; proj.sleepMs=0; hint.style.opacity=0; if(navigator.vibrate) navigator.vibrate(8);
  }

  canvas.addEventListener('pointerdown', onDown);
  canvas.addEventListener('pointermove', onMove);
  canvas.addEventListener('pointerup', onUp);
  canvas.addEventListener('pointerleave', onUp);
  canvas.addEventListener('touchstart', onDown, {passive:true});
  canvas.addEventListener('touchmove', onMove, {passive:true});
  canvas.addEventListener('touchend', onUp);

  btnStart.addEventListener('click', ()=>{ overlayStart.classList.add('hide'); tutor.style.display='none'; });
  btnAgainWin.addEventListener('click', resetGame);
  btnAgainOver.addEventListener('click', resetGame);

  function drawHeart(x,y,r,fill='#ff4d6d',stroke='rgba(0,0,0,.28)'){
    const s=r; ctx.save(); ctx.translate(x,y); ctx.beginPath(); ctx.moveTo(0,s*0.3); ctx.bezierCurveTo(0,-s*0.4,-s*0.8,-s*0.1,-s*0.8,s*0.3); ctx.bezierCurveTo(-s*0.8,s*0.9,0,s*1.2,0,s*1.6); ctx.bezierCurveTo(0,s*1.2,s*0.8,s*0.9,s*0.8,s*0.3); ctx.bezierCurveTo(s*0.8,-s*0.1,0,-s*0.4,0,s*0.3); ctx.closePath(); ctx.fillStyle=fill; ctx.fill(); ctx.lineWidth=Math.max(1.5,s*0.12); ctx.strokeStyle=stroke; ctx.stroke(); ctx.restore();
  }
  function rrect(x,y,w,h,r,fill){ const rr=Math.min(r,w/2,h/2); ctx.beginPath(); ctx.moveTo(x-w/2+rr,y-h/2); ctx.arcTo(x+w/2,y-h/2,x+w/2,y+h/2,rr); ctx.arcTo(x+w/2,y+h/2,x-w/2,y+h/2,rr); ctx.arcTo(x-w/2,y+h/2,x-w/2,y-h/2,rr); ctx.arcTo(x-w/2,y-h/2,x+w/2,y-h/2,rr); ctx.closePath(); ctx.fillStyle=fill; ctx.fill(); }

  let last = performance.now();
  function loop(now){
    const dtMs = Math.min(32, now-last); last=now;
    const dt = dtMs/1000; // seconds

    // projectile physics (px/s)
    if(proj.launched && !proj.sleeping){
      proj.vy += gravity*dt;        // gravity pulls down
      proj.x  += proj.vx*dt;
      proj.y  += proj.vy*dt;

      // ground
      if(proj.y + proj.r > groundY){
        proj.y = groundY - proj.r;
        proj.vy = -proj.vy*restitution;
        proj.vx *= FRICTION;
        if(Math.abs(proj.vy) < 12){ proj.sleeping=true; proj.sleepMs=0; }
      }
      // bounds
      if(proj.x > canvas.width + S(200) || proj.y > canvas.height + S(200) || proj.x < -S(200)){
        rearmOrEnd();
      }
    }
    // auto rearm after rest
    if(proj.sleeping){ proj.sleepMs += dtMs; if(proj.sleepMs > 900){ rearmOrEnd(); } }

    // blocks & collisions
    for(const b of blocks){
      if(b.destroyed){ b.fallAngle += 0.06*dtMs/16; b.vy += gravity*dt; b.y += b.vy*dt*0.4; b.x += b.vx*dt*0.4; continue; }
      if(!b.static){ b.vy += gravity*dt; b.y += b.vy*dt*0.4; b.x += b.vx*dt*0.4; if(b.y + b.h/2 > groundY){ b.y = groundY - b.h/2; b.vy = -b.vy*0.15; b.vx*=0.8; if(Math.abs(b.vy)>70) b.hp -= Math.abs(b.vy)*0.12; if(b.hp<=0 && !b.destroyed){ b.destroyed=true; destroyedCount++; downEl.textContent=destroyedCount; spawnLetterAt(b.x, b.y + b.h/2 + S(6)); if(destroyedCount >= blocks.length){ setTimeout(()=>{ finalTitle.textContent = MESSAGE; overlayWin.classList.remove('hide'); }, 650); } } } }
      if(proj.launched && circleRectColl(proj.x,proj.y,proj.r, b.x-b.w/2, b.y-b.h/2, b.w,b.h)){
        const nx=clamp(proj.x, b.x-b.w/2, b.x+b.w/2), ny=clamp(proj.y, b.y-b.h/2, b.y+b.h/2);
        const dx=proj.x-nx, dy=proj.y-ny; const dist=Math.hypot(dx,dy)||1; const nxn=dx/dist, nyn=dy/dist;
        const speed=Math.hypot(proj.vx,proj.vy); const power=clamp(speed*0.08, 2, 26); // dano proporcional
        proj.vx = (proj.vx - 2*nxn*(proj.vx*nxn + proj.vy*nyn)) * 0.7;
        proj.vy = (proj.vy - 2*nyn*(proj.vx*nxn + proj.vy*nyn)) * 0.7;
        blockHit(b, power, nxn, nyn);
        proj.x += nxn * 2; proj.y += nyn * 2;
      }
    }

    // letters
    updateLetters(dtMs);

    // draw
    ctx.clearRect(0,0,canvas.width,canvas.height);
    // background hills
    ctx.fillStyle='#0b1015'; ctx.beginPath(); ctx.ellipse(canvas.width*0.25, groundY+S(120), S(300), S(120), 0, 0, Math.PI*2); ctx.fill(); ctx.beginPath(); ctx.ellipse(canvas.width*0.6, groundY+S(120), S(420), S(140), 0, 0, Math.PI*2); ctx.fill();
    // ground
    ctx.fillStyle='#2a9d6b'; ctx.fillRect(0, groundY, canvas.width, canvas.height-groundY); ctx.fillStyle='rgba(255,255,255,.08)'; ctx.fillRect(0, groundY, canvas.width, S(6));

    // slingshot towers
    ctx.lineWidth=S(10); ctx.strokeStyle='#8b5a2b'; ctx.beginPath(); ctx.moveTo(sling.x - S(18), groundY); ctx.lineTo(sling.x - S(18), sling.y - S(10)); ctx.stroke(); ctx.beginPath(); ctx.moveTo(sling.x + S(18), groundY); ctx.lineTo(sling.x + S(18), sling.y - S(10)); ctx.stroke();
    if(sling.pulling){ ctx.lineWidth=S(4); ctx.strokeStyle='#f5c2c7'; ctx.beginPath(); ctx.moveTo(sling.x - S(18), sling.y - S(10)); ctx.lineTo(proj.x, proj.y); ctx.stroke(); ctx.beginPath(); ctx.moveTo(sling.x + S(18), sling.y - S(10)); ctx.lineTo(proj.x, proj.y); ctx.stroke(); }

    // blocks
    for(const b of blocks){
      if(b.destroyed){
        ctx.save(); ctx.translate(b.x,b.y); ctx.rotate(b.fallAngle*0.04); rrect(0,0,b.w,b.h,S(6),'#3d405b'); ctx.restore();
      } else {
        rrect(b.x,b.y,b.w,b.h,S(6),'#3d405b');
        ctx.fillStyle='#ff8fab'; const hpw=Math.max(0, Math.min(1, b.hp/22))*(b.w-S(10)); ctx.fillRect(b.x - b.w/2 + S(5), b.y - b.h/2 + S(4), hpw, S(4));
      }
    }

    // letters on top
    for(const lp of letterParts){ drawLetterPart(lp); }

    // projectile
    drawHeart(proj.x, proj.y - proj.r*0.9, proj.r, '#ff4d6d');

    requestAnimationFrame(loop);
  }
  requestAnimationFrame(loop);

  function rearmOrEnd(){
    // if won already, ignore
    if(destroyedCount >= blocks.length) return;
    // rearm if ainda tem chances, sen√£o game over
    if(shotsLeft > 0){
      proj.x=sling.x; proj.y=sling.y; proj.vx=0; proj.vy=0; proj.launched=false; proj.sleeping=false; proj.sleepMs=0;
    } else {
      overlayOver.classList.remove('hide');
    }
  }

  function init(){ finalTitle.textContent = MESSAGE; resetBlocks(); overlayStart.classList.remove('hide'); }
  init();

  // URL customization
  try{ const p=new URLSearchParams(location.search); if(p.get('nome')){ const n=decodeURIComponent(p.get('nome')); finalTitle.textContent=`${n}, eu te amo ‚ù§Ô∏è`; } if(p.get('msg')){ finalTitle.textContent=decodeURIComponent(p.get('msg')); } }catch{}
})();
</script>
</body>
</html>
